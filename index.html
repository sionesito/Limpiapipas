<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catálogo – Limpiapipas</title>
  <!--
    Esta plantilla implementa un flipbook realista utilizando la librería
    open source FlipBook.js (https://github.com/taufiqelrahman/flipbook-js).
    La librería está distribuida bajo licencia MIT y no tiene dependencias.

    ¿Por qué FlipBook.js?
    ---------------------------------
    FlipBook.js produce un efecto de hojeo 3D similar al de un libro
    físico y se puede inicializar con botones personalizados para
    avanzar/retroceder página. Según la documentación, soporta
    navegación por teclado, parámetros configurables de tamaño y
    callbacks para actualizar indicadores【9737911094890†L117-L126】.
    La librería también permite asignar contenedores existentes y
    contenidos HTML o imágenes a cada página【9737911094890†L163-L208】.  

    Esta plantilla genera dinámicamente las páginas a partir de
    archivos en la carpeta "images" cuyo nombre siga el patrón
    "pX-cover" y "pX-2" con extensiones .png, .jpg, .jpeg o .webp.
    Por ejemplo, p1-cover.png, p1-2.jpg, p2-cover.png, p2-2.png, etc.
    Para cada par de imágenes se crearán dos páginas consecutivas en
    orden; si un nombre o extensión no existe se omite silenciosamente.
  -->
  <!-- Carga la hoja de estilos de FlipBook.js desde jsDelivr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flipbook-js@1.1.1/dist/flipbook.min.css" />
  <style>
    :root {
      --bg: #071019;
      --accent: #06b6d4;
      --card-bg: #0f1720;
    }
    * {
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      margin: 0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      color: #fff;
    }
    .wrap {
      max-width: 1100px;
      margin: 24px auto;
      padding: 16px;
    }
    header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
    }
    header h1 {
      font-size: 1.25rem;
      margin: 0;
    }
    #catalog {
      position: relative;
      width: 100%;
      /* La altura se ajusta por script para que mantenga proporción */
      margin: 0 auto;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      overflow: hidden;
      background: var(--card-bg);
    }
    /* Cada página del flipbook: el script añade la clase c-flipbook__page
       pero aquí podemos dar estilo base a las imágenes */
    .page-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      background: #222;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
      gap: 12px;
    }
    .controls .nav {
      display: flex;
      gap: 8px;
    }
    button {
      background: var(--accent);
      color: #022;
      border: none;
      padding: 10px 12px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    button:disabled {
      opacity: .45;
      cursor: default;
    }
    #pager {
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <!-- Ajusta el src del logo si tienes un archivo de logo en tu carpeta images -->
      <img src="images/logo.png" alt="logo" style="height:40px;object-fit:contain" />
      <h1>Catálogo — Limpiapipas</h1>
    </header>

    <div id="catalog" aria-label="Catálogo hojeable">
      <!-- Las páginas se insertarán aquí por JavaScript -->
      <div id="loading" style="padding:16px;font-weight:600;color:#9be9ee">Cargando páginas…</div>
    </div>

    <div class="controls">
      <div class="nav">
        <button id="prev">« Anterior</button>
        <button id="next">Siguiente »</button>
      </div>
      <div id="pager">Página 0 / 0</div>
    </div>
  </div>

  <!-- Carga la biblioteca FlipBook.js desde jsDelivr -->
  <script src="https://cdn.jsdelivr.net/npm/flipbook-js@1.1.1/dist/flipbook.umd.min.js"></script>
  <script>
    (function(){
      const bookEl = document.getElementById('catalog');
      const loadingEl = document.getElementById('loading');
      const pagerEl = document.getElementById('pager');
      const prevBtn = document.getElementById('prev');
      const nextBtn = document.getElementById('next');

      // Parámetros de detección de imágenes
      const maxPairs = 12; // Ajusta según el número de páginas (pX-cover & pX-2)
      const basenames = [];
      for (let i = 1; i <= maxPairs; i++) {
        basenames.push(`p${i}-cover`);
        basenames.push(`p${i}-2`);
      }
      const exts = ['.png','.jpg','.jpeg','.webp'];

      // Comprueba si existe un archivo en la carpeta images probando extensiones.
      async function findUrl(base) {
        for (const ext of exts) {
          const url = `images/${base}${ext}`;
          try {
            // HEAD chequea existencia sin descargar entero
            const resp = await fetch(url, { method: 'HEAD' });
            if (resp.ok) return url;
          } catch (e) {
            // ignorar errores de red
          }
        }
        return null;
      }

      // Genera la lista de URLs válidas en el orden correcto
      async function buildPages() {
        const urls = [];
        for (const base of basenames) {
          const found = await findUrl(base);
          if (found) urls.push(found);
        }
        return urls;
      }

      // Inserta nodos de página en el DOM para FlipBook.js
      function renderPages(urls) {
        bookEl.innerHTML = '';
        urls.forEach(url => {
          const page = document.createElement('div');
          page.className = 'c-flipbook__page';
          const img = document.createElement('img');
          img.className = 'page-img';
          img.src = url;
          img.alt = '';
          page.appendChild(img);
          bookEl.appendChild(page);
        });
      }

      // Ajusta la altura del contenedor según el viewport.
      function adjustHeight() {
        const vh = Math.max(window.innerHeight * 0.7, 500);
        bookEl.style.height = vh + 'px';
      }

      // Inicializa FlipBook con los botones externos
      let flipbookInstance = null;
      function initFlip() {
        // Destruye instancia previa si existe
        if (flipbookInstance) {
          try { flipbookInstance = null; } catch (e) {}
        }
        // Configura altura
        adjustHeight();
        // Crea nueva instancia
        flipbookInstance = new FlipBook(bookEl, {
          nextButton: nextBtn,
          previousButton: prevBtn,
          canClose: false,
          arrowKeys: true,
          initialActivePage: 0,
          width: '100%',
          height: bookEl.style.height,
          onPageTurn: () => updatePager()
        });
        updatePager();
      }

      // Actualiza el indicador de página
      function updatePager() {
        if (!flipbookInstance) return;
        const active = flipbookInstance.getActivePages();
        const current = active.length ? active[0] + 1 : 1;
        const total = flipbookInstance.pages ? flipbookInstance.pages.length : 0;
        pagerEl.textContent = `Página ${current} / ${total}`;
        prevBtn.disabled = flipbookInstance.isFirstPage();
        nextBtn.disabled = flipbookInstance.isLastPage();
      }

      // Flujo principal
      (async function(){
        loadingEl.textContent = 'Buscando imágenes…';
        const urls = await buildPages();
        if (urls.length === 0) {
          loadingEl.textContent = 'No se encontraron imágenes en la carpeta "images".\n' +
            'Añade archivos como p1-cover.png, p1-2.jpg, p2-cover.png…';
          return;
        }
        loadingEl.remove();
        renderPages(urls);
        // Espera a que se carguen todas las imágenes para evitar saltos
        const imgs = Array.from(bookEl.querySelectorAll('img'));
        await Promise.all(imgs.map(img => new Promise(res => {
          if (img.complete) return res();
          img.onload = img.onerror = () => res();
        })));
        initFlip();
      })();

      // Actualizar tamaño cuando redimensione la ventana
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          if (flipbookInstance) {
            adjustHeight();
            // Reestablece las dimensiones en la instancia
            flipbookInstance.el.style.height = bookEl.style.height;
          }
        }, 250);
      });
    })();
  </script>
</body>
</html>