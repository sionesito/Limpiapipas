<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Catálogo — Limpiapipas (Flipbook)</title>

<style>
  :root{--bg:#071019;--card:#0f1720;--accent:#06b6d4}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:#fff}
  .wrap{max-width:1100px;margin:24px auto;padding:16px}
  header{display:flex;align-items:center;gap:12px;margin-bottom:14px}
  header h1{font-size:1.25rem;margin:0}
  /* Book container (page-flip target) */
  #book {
    width:100%;
    height:72vh;
    min-height:420px;
    margin:0 auto;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    border-radius:10px;
    box-shadow:0 10px 30px rgba(0,0,0,0.6);
    overflow:hidden;
  }

  /* Pages (each page content). page-flip will handle layout. */
  .page {
    display:flex;
    align-items:center;
    justify-content:center;
    padding:12px;
    background: #ffffff00;
  }
  .page img{
    width:100%;
    height:100%;
    max-width:100%;
    max-height:100%;
    object-fit:cover; /* importante: mantener proporción sin distorsionar */
    border-radius:6px;
    display:block;
    background:#222;
  }

  /* Controles */
  .controls{display:flex;justify-content:space-between;align-items:center;margin-top:10px;gap:12px}
  .controls .nav{display:flex;gap:8px}
  button{background:var(--accent);color:#022;border:none;padding:10px 12px;border-radius:8px;font-weight:600;cursor:pointer}
  button:disabled{opacity:.45;cursor:default}

  /* Fallback viewer (simple horizontal slider) */
  .fallback { display:none; gap:12px; overflow-x:auto; padding:8px }
  .fallback .thumb { width:280px; flex:0 0 auto; background:var(--card); padding:8px; border-radius:8px }
  .fallback .thumb img{height:180px; object-fit:cover; width:100%; border-radius:6px}

  @media (max-width:800px){
    #book{height:66vh}
    .fallback .thumb img{height:160px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="images/logo.png" alt="logo" style="height:40px;object-fit:contain"/>
      <h1>Catálogo — Limpiapipas</h1>
    </header>

    <!-- Book target for PageFlip -->
    <div id="book" aria-label="Catálogo hojeable">
      <!-- Each .page will be used by the page-flip library -->
      <div class="page"><img src="images/page1.jpg" alt="Portada"></div>
      <div class="page"><img src="images/page2.jpg" alt="Página 2"></div>
      <div class="page"><img src="images/page3.jpg" alt="Página 3"></div>
      <div class="page"><img src="images/page4.jpg" alt="Página 4"></div>
      <div class="page"><img src="images/page5.jpg" alt="Página 5"></div>
      <!-- agrega más .page según necesites -->
    </div>

    <!-- fallback simple thumbs / slider si la librería no carga -->
    <div class="fallback" id="fallback">
      <div class="thumb"><img src="images/page1.jpg" alt=""></div>
      <div class="thumb"><img src="images/page2.jpg" alt=""></div>
      <div class="thumb"><img src="images/page3.jpg" alt=""></div>
    </div>

    <div class="controls" style="margin-top:12px">
      <div class="nav">
        <button id="prev">« Anterior</button>
        <button id="next">Siguiente »</button>
      </div>
      <div id="pager">Página 1 / 1</div>
    </div>
  </div>

  <!-- PageFlip (page-flip) desde CDN -->
  <script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.min.js"></script>

  <script>
    // funciones util
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    // config inicial: calcula tamaño basado en viewport (para mantener proporciones)
    function calcSize() {
      const vw = Math.min(window.innerWidth, 1100) * 0.9;
      const vh = Math.max(window.innerHeight * 0.6, 420);
      // relación base de página (ancho:alto) 3:4 para apariencia similar a revista
      const width = Math.round(vw);
      const height = Math.round(vh);
      return { width, height };
    }

    // inicializa PageFlip
    let pageFlip = null;
    function initFlip() {
      const bookEl = document.getElementById('book');
      if (!window.PageFlip) {
        console.warn('PageFlip no está disponible (CDN falló). Activando fallback.');
        showFallback();
        return;
      }

      // Destruye instancia previa si existe
      try { if (pageFlip) pageFlip.destroy(); } catch(e){}

      const size = calcSize();
      pageFlip = new window.PageFlip(bookEl, {
        width: size.width,
        height: size.height,
        size: "stretch",      // ajusta al contenedor
        maxShadowOpacity: 0.35,
        showCover: true,
        mobileScrollSupport: false
      });

      // carga las páginas desde el DOM
      pageFlip.loadFromHTML( document.querySelectorAll('.page') );

      // controles
      $('#prev').onclick = ()=> pageFlip.flipPrev();
      $('#next').onclick = ()=> pageFlip.flipNext();

      // actualizar indicador
      function updatePager() {
        const current = pageFlip.getCurrentPageIndex() + 1;
        const total = pageFlip.getPageCount();
        $('#pager').textContent = `Página ${current} / ${total}`;
        $('#prev').disabled = current === 1;
        $('#next').disabled = current === total;
      }
      // escucha evento flip
      pageFlip.on('flip', updatePager);
      // init pager
      setTimeout(updatePager, 250);
    }

    // fallback si CDN falla
    function showFallback(){
      document.getElementById('book').style.display = 'none';
      document.getElementById('fallback').style.display = 'flex';
      // simple pager update
      const thumbs = $$('#fallback .thumb img');
      let idx = 0;
      function updatePager() {
        $('#pager').textContent = `Página ${idx+1} / ${thumbs.length}`;
        $('#prev').disabled = idx === 0;
        $('#next').disabled = idx === thumbs.length-1;
      }
      $('#prev').onclick = ()=> { if(idx>0){ idx--; thumbs.forEach((t,i)=> t.parentNode.style.display = i===idx? 'block':'none'); updatePager(); } };
      $('#next').onclick = ()=> { if(idx<thumbs.length-1){ idx++; thumbs.forEach((t,i)=> t.parentNode.style.display = i===idx? 'block':'none'); updatePager(); } };
      // muestra sólo la primera thumb
      thumbs.forEach((t,i)=> t.parentNode.style.display = i===0? 'block':'none');
      updatePager();
    }

    // init y resize (debounce para evitar recreaciones contínuas)
    let rtid = null;
    function handleResize(){
      clearTimeout(rtid);
      rtid = setTimeout(()=> {
        if (pageFlip) {
          // best effort: recrear para recalcular dimensiones
          initFlip();
        } else {
          // si no hay pageFlip, no-hacer nada
        }
      }, 220);
    }

    // espera carga de imágenes antes de iniciar (evita páginas en blanco)
    function preloadImages(selector, cb) {
      const imgs = Array.from(document.querySelectorAll(selector));
      if (imgs.length === 0) return cb();
      let done = 0;
      imgs.forEach(img=>{
        if (img.complete) { done++; if(done===imgs.length) cb(); return; }
        img.onload = img.onerror = ()=> { done++; if(done===imgs.length) cb(); };
      });
    }

    window.addEventListener('load', ()=> {
      preloadImages('#book img', initFlip);
      window.addEventListener('resize', handleResize);
    });

  </script>
</body>
</html>
